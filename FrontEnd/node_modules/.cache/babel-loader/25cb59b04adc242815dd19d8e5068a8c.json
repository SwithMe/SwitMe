{"ast":null,"code":"import _slicedToArray from\"D:/SwitMe/FrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"D:/SwitMe/FrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import React,{useState,useRef,useEffect}from\"react\";import styled from\"styled-components\";import\"../assets/chat.css\";import Title from\"./Title\";import Input from\"./Input\";import{getMessages}from\"../_actions/actions\";import{useDispatch}from\"react-redux\";import SockJS from\"sockjs-client\";import*as StompJs from\"@stomp/stompjs\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Content=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  min-height: 660px;\\n  background-color: #56be9c;\\n  padding: 30px;\\n\"])));var Row=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: \",\";\\n  align-items: center;\\n\"])),function(props){return props.location||\"left\";});var Bubble=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  background-color: #ffffff;\\n  border-radius: 10px;\\n  font-family: \\\"NotoSans\\\";\\n  font-size: 14px;\\n  text-align: start;\\n  padding: 10px;\\n  max-width: 300px;\\n  margin-bottom: 10px;\\n  margin-left: 100px;\\n  margin-right: 15px;\\n  z-index: 5;\\n  word-wrap: break-word;\\n\"])));var Chat=function Chat(props){// 열기, 닫기, 모달 헤더 텍스트를 부모로부터 받아옴\nvar open=props.open,close=props.close,header=props.header,other_user=props.other_user,other_user_name=props.other_user_name,room_idx=props.room_idx;var myid=window.localStorage.getItem(\"id\");var myname=\"나\";var last=useRef(\"\");var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];var dispatch=useDispatch();var client=useRef({});useEffect(function(){dispatch(getMessages(room_idx)).then(function(response){if(response.payload){console.log(response);setMessages(response.payload);}else{console.log(\"메세지 목록 가져오기 에러\");}});client.current=new StompJs.Client({//brokerURL: \"ws://localhost:8080/sock\",\nwebSocketFactory:function webSocketFactory(){return new SockJS(\"/sock\");},debug:function debug(str){console.log(str);},reconnectDelay:5000,heartbeatIncoming:4000,heartbeatOutgoing:4000});var callback=function callback(message){if(message.body){dispatch(getMessages(room_idx)).then(function(response){if(response.payload){setMessages(response.payload);last.current=\"\";}else{console.log(\"메세지 목록 가져오기 에러\");}});}else{alert(\"got empty message\");}};client.current.onConnect=function(frame){client.current.subscribe(\"/topic/\".concat(room_idx),callback);};client.current.onStompError=function(frame){console.log(\"Broker reported error: \"+frame.headers[\"message\"]);console.log(\"Additional details: \"+frame.body);};client.current.activate();last.current=\"\";},[]);var onInputChange=function onInputChange(e){setMessage(e.target.value);last.current=\"\";};var sendMessage=function sendMessage(){client.current.publish({destination:\"/pub/chat/message\",body:JSON.stringify({room_idx:room_idx,user_idx:myid,user_name:myname,message:message})});setMessage(\"\");dispatch(getMessages(room_idx)).then(function(response){if(response.payload){console.log(response);setMessages(response.payload);}else{console.log(\"메세지 목록 가져오기 에러\");}});};var disconnect=function disconnect(){client.current.publish({destination:\"/pub/disconnect\",body:JSON.stringify({room_idx:room_idx,user_idx:myid})});close();};return/*#__PURE__*/ (// 모달이 열릴때 openModal 클래스가 생성된다.\n_jsx(\"div\",{className:open?\"openModal modal\":\"modal\",style:{backgroundColor:\"rgba(0, 0, 0, 0)\"},children:open?/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsxs(\"header\",{style:{height:\"95px\",alignItems:\"center\",display:\"flex\",justifyContent:\"center\",boxShadow:\"0px 5px 15px grey\"},children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Title,{children:other_user_name})}),header,/*#__PURE__*/_jsxs(\"button\",{className:\"close\",onClick:disconnect,children:[\" \",\"\\xD7\",\" \"]})]}),/*#__PURE__*/_jsx(Content,{children:messages===null||messages===void 0?void 0:messages.map(function(message,i){if(last.current!==message.sender_idx&&message.sender_idx!==myid){last.current=message.sender_idx;return/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(\"img\",{alt:\"profile\",src:message.self_image,style:{width:\"70px\",height:\"70px\",marginRight:\"10px\",position:\"absolute\",borderRadius:\"50%\"}}),/*#__PURE__*/_jsx(\"img\",{alt:\"left\",src:require(\"../assets/left.png\").default,style:{width:\"28px\",height:\"17px\",marginRight:\"-112px\",marginLeft:\"85px\"}}),/*#__PURE__*/_jsx(Bubble,{children:message.message})]});}else if(message.sender_idx!==myid){return/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Bubble,{marginLeft:\"100\",children:message.message})});}else if(last.current!==myid&&message.sender_idx===myid){last.current=myid;return/*#__PURE__*/_jsxs(Row,{location:\"flex-end\",children:[/*#__PURE__*/_jsx(Bubble,{children:message.message}),/*#__PURE__*/_jsx(\"img\",{alt:\"right\",src:require(\"../assets/right.png\").default,style:{width:\"28px\",height:\"17px\",marginLeft:\"-27px\"}})]});}else{return/*#__PURE__*/_jsx(Row,{location:\"flex-end\",children:/*#__PURE__*/_jsx(Bubble,{children:message.message})});}})}),/*#__PURE__*/_jsx(\"footer\",{children:/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"row\",height:\"67px\",alignItems:\"center\",justifyContent:\"space-around\"},children:[/*#__PURE__*/_jsx(Input,{width:\"382\",validinput:\"true\",placeholder:\"\\uB0B4\\uC6A9\\uC744 \\uC785\\uB825\\uD558\\uC138\\uC694\",inputwidth:\"350\",value:message,onChange:onInputChange}),/*#__PURE__*/_jsx(\"img\",{alt:\"send\",src:require(\"../assets/paperplane.png\").default,style:{width:\"31px\",height:\"34px\",cursor:\"pointer\"},onClick:sendMessage})]})})]}):null}));};export default Chat;","map":{"version":3,"sources":["D:/SwitMe/FrontEnd/src/components/Chat.js"],"names":["React","useState","useRef","useEffect","styled","Title","Input","getMessages","useDispatch","SockJS","StompJs","Content","div","Row","props","location","Bubble","Chat","open","close","header","other_user","other_user_name","room_idx","myid","window","localStorage","getItem","myname","last","message","setMessage","messages","setMessages","dispatch","client","then","response","payload","console","log","current","Client","webSocketFactory","debug","str","reconnectDelay","heartbeatIncoming","heartbeatOutgoing","callback","body","alert","onConnect","frame","subscribe","onStompError","headers","activate","onInputChange","e","target","value","sendMessage","publish","destination","JSON","stringify","user_idx","user_name","disconnect","backgroundColor","height","alignItems","display","justifyContent","boxShadow","map","i","sender_idx","self_image","width","marginRight","position","borderRadius","require","default","marginLeft","flexDirection","cursor"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport \"../assets/chat.css\";\r\nimport Title from \"./Title\";\r\nimport Input from \"./Input\";\r\nimport { getMessages } from \"../_actions/actions\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport SockJS from \"sockjs-client\";\r\nimport * as StompJs from \"@stomp/stompjs\";\r\n\r\nconst Content = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  min-height: 660px;\r\n  background-color: #56be9c;\r\n  padding: 30px;\r\n`;\r\nconst Row = styled.div`\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: ${(props) => props.location || \"left\"};\r\n  align-items: center;\r\n`;\r\nconst Bubble = styled.div`\r\n  background-color: #ffffff;\r\n  border-radius: 10px;\r\n  font-family: \"NotoSans\";\r\n  font-size: 14px;\r\n  text-align: start;\r\n  padding: 10px;\r\n  max-width: 300px;\r\n  margin-bottom: 10px;\r\n  margin-left: 100px;\r\n  margin-right: 15px;\r\n  z-index: 5;\r\n  word-wrap: break-word;\r\n`;\r\n\r\nconst Chat = (props) => {\r\n  // 열기, 닫기, 모달 헤더 텍스트를 부모로부터 받아옴\r\n  const { open, close, header, other_user, other_user_name, room_idx } = props;\r\n  const myid = window.localStorage.getItem(\"id\");\r\n  const myname = \"나\";\r\n  const last = useRef(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n  const [messages, setMessages] = useState([]);\r\n  const dispatch = useDispatch();\r\n  const client = useRef({});\r\n\r\n  useEffect(() => {\r\n    dispatch(getMessages(room_idx)).then((response) => {\r\n      if (response.payload) {\r\n        console.log(response);\r\n        setMessages(response.payload);\r\n      } else {\r\n        console.log(\"메세지 목록 가져오기 에러\");\r\n      }\r\n    });\r\n    client.current = new StompJs.Client({\r\n      //brokerURL: \"ws://localhost:8080/sock\",\r\n      webSocketFactory: () => new SockJS(\"/sock\"),\r\n      debug: function (str) {\r\n        console.log(str);\r\n      },\r\n      reconnectDelay: 5000,\r\n      heartbeatIncoming: 4000,\r\n      heartbeatOutgoing: 4000,\r\n    });\r\n\r\n    const callback = (message) => {\r\n      if (message.body) {\r\n        dispatch(getMessages(room_idx)).then((response) => {\r\n          if (response.payload) {\r\n            setMessages(response.payload);\r\n            last.current = \"\";\r\n          } else {\r\n            console.log(\"메세지 목록 가져오기 에러\");\r\n          }\r\n        });\r\n      } else {\r\n        alert(\"got empty message\");\r\n      }\r\n    };\r\n\r\n    client.current.onConnect = function (frame) {\r\n      client.current.subscribe(`/topic/${room_idx}`, callback);\r\n    };\r\n    client.current.onStompError = function (frame) {\r\n      console.log(\"Broker reported error: \" + frame.headers[\"message\"]);\r\n      console.log(\"Additional details: \" + frame.body);\r\n    };\r\n\r\n    client.current.activate();\r\n    last.current = \"\";\r\n  }, []);\r\n\r\n  const onInputChange = (e) => {\r\n    setMessage(e.target.value);\r\n    last.current = \"\";\r\n  };\r\n\r\n  const sendMessage = () => {\r\n    client.current.publish({\r\n      destination: \"/pub/chat/message\",\r\n      body: JSON.stringify({\r\n        room_idx: room_idx,\r\n        user_idx: myid,\r\n        user_name: myname,\r\n        message: message,\r\n      }),\r\n    });\r\n    setMessage(\"\");\r\n    dispatch(getMessages(room_idx)).then((response) => {\r\n      if (response.payload) {\r\n        console.log(response);\r\n        setMessages(response.payload);\r\n      } else {\r\n        console.log(\"메세지 목록 가져오기 에러\");\r\n      }\r\n    });\r\n  };\r\n\r\n  const disconnect = () => {\r\n    client.current.publish({\r\n      destination: \"/pub/disconnect\",\r\n      body: JSON.stringify({\r\n        room_idx: room_idx,\r\n        user_idx: myid,\r\n      }),\r\n    });\r\n    close();\r\n  };\r\n\r\n  return (\r\n    // 모달이 열릴때 openModal 클래스가 생성된다.\r\n    <div\r\n      className={open ? \"openModal modal\" : \"modal\"}\r\n      style={{ backgroundColor: \"rgba(0, 0, 0, 0)\" }}\r\n    >\r\n      {open ? (\r\n        <section>\r\n          <header\r\n            style={{\r\n              height: \"95px\",\r\n              alignItems: \"center\",\r\n              display: \"flex\",\r\n              justifyContent: \"center\",\r\n              boxShadow: \"0px 5px 15px grey\",\r\n            }}\r\n          >\r\n            <div>\r\n              <Title>{other_user_name}</Title>\r\n            </div>\r\n            {header}\r\n            <button className=\"close\" onClick={disconnect}>\r\n              {\" \"}\r\n              &times;{\" \"}\r\n            </button>\r\n          </header>\r\n          <Content>\r\n            {messages?.map((message, i) => {\r\n              if (\r\n                last.current !== message.sender_idx &&\r\n                message.sender_idx !== myid\r\n              ) {\r\n                last.current = message.sender_idx;\r\n                return (\r\n                  <Row>\r\n                    <img\r\n                      alt=\"profile\"\r\n                      src={message.self_image}\r\n                      style={{\r\n                        width: \"70px\",\r\n                        height: \"70px\",\r\n                        marginRight: \"10px\",\r\n                        position: \"absolute\",\r\n                        borderRadius: \"50%\",\r\n                      }}\r\n                    />\r\n                    <img\r\n                      alt=\"left\"\r\n                      src={require(\"../assets/left.png\").default}\r\n                      style={{\r\n                        width: \"28px\",\r\n                        height: \"17px\",\r\n                        marginRight: \"-112px\",\r\n                        marginLeft: \"85px\",\r\n                      }}\r\n                    />\r\n                    <Bubble>{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              } else if (message.sender_idx !== myid) {\r\n                return (\r\n                  <Row>\r\n                    <Bubble marginLeft=\"100\">{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              } else if (last.current !== myid && message.sender_idx === myid) {\r\n                last.current = myid;\r\n                return (\r\n                  <Row location=\"flex-end\">\r\n                    <Bubble>{message.message}</Bubble>\r\n                    <img\r\n                      alt=\"right\"\r\n                      src={require(\"../assets/right.png\").default}\r\n                      style={{\r\n                        width: \"28px\",\r\n                        height: \"17px\",\r\n                        marginLeft: \"-27px\",\r\n                      }}\r\n                    />\r\n                  </Row>\r\n                );\r\n              } else {\r\n                return (\r\n                  <Row location=\"flex-end\">\r\n                    <Bubble>{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              }\r\n            })}\r\n          </Content>\r\n\r\n          <footer>\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                flexDirection: \"row\",\r\n                height: \"67px\",\r\n                alignItems: \"center\",\r\n                justifyContent: \"space-around\",\r\n              }}\r\n            >\r\n              <Input\r\n                width=\"382\"\r\n                validinput=\"true\"\r\n                placeholder=\"내용을 입력하세요\"\r\n                inputwidth=\"350\"\r\n                value={message}\r\n                onChange={onInputChange}\r\n              ></Input>\r\n              <img\r\n                alt=\"send\"\r\n                src={require(\"../assets/paperplane.png\").default}\r\n                style={{ width: \"31px\", height: \"34px\", cursor: \"pointer\" }}\r\n                onClick={sendMessage}\r\n              />\r\n            </div>\r\n          </footer>\r\n        </section>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"]},"metadata":{},"sourceType":"module"}
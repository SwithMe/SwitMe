{"ast":null,"code":"var _jsxFileName = \"D:\\\\SwitMe\\\\FrontEnd\\\\src\\\\components\\\\Chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport \"../assets/chat.css\";\nimport Title from \"./Title\";\nimport Input from \"./Input\";\nimport { getMessages } from \"../_actions/actions\";\nimport { useDispatch } from \"react-redux\";\nimport SockJS from \"sockjs-client\";\nimport { Client } from \"@stomp/stompjs\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Content = styled.div`\n  display: flex;\n  flex-direction: column;\n  min-height: 660px;\n  background-color: #56be9c;\n  padding: 30px;\n`;\n_c = Content;\nconst Row = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  justify-content: ${props => props.location || \"left\"};\n  align-items: center;\n`;\n_c2 = Row;\nconst Bubble = styled.div`\n  background-color: #ffffff;\n  border-radius: 10px;\n  font-family: \"NotoSans\";\n  font-size: 14px;\n  text-align: center;\n  padding: 10px;\n  max-width: 62px;\n  margin-bottom: 10px;\n  margin-left: 100px;\n  margin-right: 15px;\n  z-index: 5;\n`;\n_c3 = Bubble;\n\nconst Chat = props => {\n  _s();\n\n  // 열기, 닫기, 모달 헤더 텍스트를 부모로부터 받아옴\n  const {\n    open,\n    close,\n    header,\n    other_user,\n    leader,\n    user,\n    room_idx\n  } = props; //const myname = window.localStorage.getItem(\"name\");\n  //const myid = window.localStorage.getItem(\"id\");\n\n  const myid = 1;\n  const myname = \"나\";\n  const other = other_user;\n  const leader_idx = leader;\n  const member_idx = user;\n  const last = useRef(\"\");\n  const [message, setMessage] = useState();\n  const [messages, setMessages] = useState([{\n    message: \"안녕\",\n    time: \"2021-07-28\",\n    sender_UserIdx: 2,\n    sender_UserName: \"친구\",\n    room_RoomIdx: 1\n  }, {\n    message: \"안녕!\",\n    time: \"2021-07-28\",\n    sender_UserIdx: 2,\n    sender_UserName: \"친구\",\n    room_RoomIdx: 1\n  }, {\n    message: \"안녕?\",\n    time: \"2021-07-28\",\n    sender_UserIdx: 1,\n    sender_UserName: \"나\",\n    room_RoomIdx: 1\n  }, {\n    message: \"안녕!!!\",\n    time: \"2021-07-28\",\n    sender_UserIdx: 1,\n    sender_UserName: \"나\",\n    room_RoomIdx: 1\n  }, {\n    message: \"안녕~\",\n    time: \"2021-07-28\",\n    sender_UserIdx: 1,\n    sender_UserName: \"친구\",\n    room_RoomIdx: 1\n  }]);\n  var client = new Client();\n  client.configure({\n    brokerURL: \"ws://localhost:5000/sock\",\n    debug: function (str) {\n      console.log(str);\n    },\n    reconnectDelay: 5000,\n    heartbeatIncoming: 4000,\n    heartbeatOutgoing: 4000,\n    onConnect: () => {\n      console.log(\"onConnect\");\n    }\n  });\n\n  const callback = message => {\n    if (message.body) {\n      alert(\"got message with body \" + message.body);\n    } else {\n      alert(\"got empty message\");\n    }\n  };\n\n  client.onConnect = function (frame) {\n    client.subscribe(`/topic/${room_idx}`, callback);\n  };\n\n  client.onStompError = function (frame) {\n    console.log(\"Broker reported error: \" + frame.headers[\"message\"]);\n    console.log(\"Additional details: \" + frame.body);\n  };\n\n  client.activate();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    // dispatch(getMessages(room_idx)).then((response) => {\n    //   if (response.payload) {\n    //     setMessage(response.payload);\n    //   } else {\n    //     console.log(\"메세지 목록 가져오기 에러\");\n    //   }\n    // });\n    last.current = \"\";\n  }, []);\n\n  const onInputChange = e => {\n    setMessage(e.target.value);\n    last.current = \"\";\n  };\n\n  const sendMessage = () => {\n    client.publish({\n      destination: \"/pub/message\",\n      body: JSON.stringify({\n        room_idx: room_idx,\n        user_idx: myid,\n        user_name: myname,\n        message: message\n      })\n    });\n    setMessage(\"\");\n  };\n\n  const disconnect = () => {\n    client.publish({\n      destination: \"/pub/message\",\n      body: JSON.stringify({\n        room_idx: room_idx,\n        user_idx: myid\n      })\n    });\n    close();\n  };\n\n  return (\n    /*#__PURE__*/\n    // 모달이 열릴때 openModal 클래스가 생성된다.\n    _jsxDEV(\"div\", {\n      className: open ? \"openModal modal\" : \"modal\",\n      style: {\n        backgroundColor: \"rgba(0, 0, 0, 0)\"\n      },\n      children: open ? /*#__PURE__*/_jsxDEV(\"section\", {\n        children: [/*#__PURE__*/_jsxDEV(\"header\", {\n          style: {\n            height: \"95px\",\n            alignItems: \"center\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            boxShadow: \"0px 5px 15px grey\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(Title, {\n              children: other ? other : member_idx ? member_idx : leader_idx\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, this), header, /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"close\",\n            onClick: disconnect,\n            children: [\" \", \"\\xD7\", \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Content, {\n          children: messages === null || messages === void 0 ? void 0 : messages.map((message, i) => {\n            if (last.current !== message.sender_UserName && message.sender_UserName !== myname) {\n              last.current = message.sender_UserName;\n              return /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  alt: \"profile\",\n                  src: require(\"../assets/profile.png\").default,\n                  style: {\n                    width: \"70px\",\n                    height: \"70px\",\n                    marginRight: \"10px\",\n                    position: \"absolute\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 198,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n                  alt: \"left\",\n                  src: require(\"../assets/left.png\").default,\n                  style: {\n                    width: \"28px\",\n                    height: \"17px\",\n                    marginRight: \"-112px\",\n                    marginLeft: \"85px\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 208,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Bubble, {\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 218,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 197,\n                columnNumber: 19\n              }, this);\n            } else if (message.sender_UserName !== myname) {\n              return /*#__PURE__*/_jsxDEV(Row, {\n                children: /*#__PURE__*/_jsxDEV(Bubble, {\n                  marginLeft: \"100\",\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 224,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 223,\n                columnNumber: 19\n              }, this);\n            } else if (last.current !== myname && message.sender_UserName === myname) {\n              last.current = myname;\n              return /*#__PURE__*/_jsxDEV(Row, {\n                location: \"flex-end\",\n                children: [/*#__PURE__*/_jsxDEV(Bubble, {\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 234,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n                  alt: \"right\",\n                  src: require(\"../assets/right.png\").default,\n                  style: {\n                    width: \"28px\",\n                    height: \"17px\",\n                    marginLeft: \"-27px\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 235,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 19\n              }, this);\n            } else {\n              return /*#__PURE__*/_jsxDEV(Row, {\n                location: \"flex-end\",\n                children: /*#__PURE__*/_jsxDEV(Bubble, {\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 249,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 248,\n                columnNumber: 19\n              }, this);\n            }\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"footer\", {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              flexDirection: \"row\",\n              height: \"67px\",\n              alignItems: \"center\",\n              justifyContent: \"space-around\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              width: \"382\",\n              validinput: \"true\",\n              placeholder: \"\\uB0B4\\uC6A9\\uC744 \\uC785\\uB825\\uD558\\uC138\\uC694\",\n              inputwidth: \"350\",\n              value: message,\n              onChange: onInputChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n              alt: \"send\",\n              src: require(\"../assets/paperplane.png\").default,\n              style: {\n                width: \"31px\",\n                height: \"34px\",\n                cursor: \"pointer\"\n              },\n              onClick: sendMessage\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 274,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this) : null\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 5\n    }, this)\n  );\n};\n\n_s(Chat, \"efZemsH4e3xcScdEWfJhAejXGqg=\", false, function () {\n  return [useDispatch];\n});\n\n_c4 = Chat;\nexport default Chat;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Content\");\n$RefreshReg$(_c2, \"Row\");\n$RefreshReg$(_c3, \"Bubble\");\n$RefreshReg$(_c4, \"Chat\");","map":{"version":3,"sources":["D:/SwitMe/FrontEnd/src/components/Chat.js"],"names":["React","useState","useRef","useEffect","styled","Title","Input","getMessages","useDispatch","SockJS","Client","Content","div","Row","props","location","Bubble","Chat","open","close","header","other_user","leader","user","room_idx","myid","myname","other","leader_idx","member_idx","last","message","setMessage","messages","setMessages","time","sender_UserIdx","sender_UserName","room_RoomIdx","client","configure","brokerURL","debug","str","console","log","reconnectDelay","heartbeatIncoming","heartbeatOutgoing","onConnect","callback","body","alert","frame","subscribe","onStompError","headers","activate","dispatch","current","onInputChange","e","target","value","sendMessage","publish","destination","JSON","stringify","user_idx","user_name","disconnect","backgroundColor","height","alignItems","display","justifyContent","boxShadow","map","i","require","default","width","marginRight","position","marginLeft","flexDirection","cursor"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport \"../assets/chat.css\";\r\nimport Title from \"./Title\";\r\nimport Input from \"./Input\";\r\nimport { getMessages } from \"../_actions/actions\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport SockJS from \"sockjs-client\";\r\nimport { Client } from \"@stomp/stompjs\";\r\n\r\nconst Content = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  min-height: 660px;\r\n  background-color: #56be9c;\r\n  padding: 30px;\r\n`;\r\nconst Row = styled.div`\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: ${(props) => props.location || \"left\"};\r\n  align-items: center;\r\n`;\r\nconst Bubble = styled.div`\r\n  background-color: #ffffff;\r\n  border-radius: 10px;\r\n  font-family: \"NotoSans\";\r\n  font-size: 14px;\r\n  text-align: center;\r\n  padding: 10px;\r\n  max-width: 62px;\r\n  margin-bottom: 10px;\r\n  margin-left: 100px;\r\n  margin-right: 15px;\r\n  z-index: 5;\r\n`;\r\n\r\nconst Chat = (props) => {\r\n  // 열기, 닫기, 모달 헤더 텍스트를 부모로부터 받아옴\r\n  const { open, close, header, other_user, leader, user, room_idx } = props;\r\n  //const myname = window.localStorage.getItem(\"name\");\r\n  //const myid = window.localStorage.getItem(\"id\");\r\n  const myid = 1;\r\n  const myname = \"나\";\r\n  const other = other_user;\r\n  const leader_idx = leader;\r\n  const member_idx = user;\r\n  const last = useRef(\"\");\r\n  const [message, setMessage] = useState();\r\n  const [messages, setMessages] = useState([\r\n    {\r\n      message: \"안녕\",\r\n      time: \"2021-07-28\",\r\n      sender_UserIdx: 2,\r\n      sender_UserName: \"친구\",\r\n      room_RoomIdx: 1,\r\n    },\r\n    {\r\n      message: \"안녕!\",\r\n      time: \"2021-07-28\",\r\n      sender_UserIdx: 2,\r\n      sender_UserName: \"친구\",\r\n      room_RoomIdx: 1,\r\n    },\r\n    {\r\n      message: \"안녕?\",\r\n      time: \"2021-07-28\",\r\n      sender_UserIdx: 1,\r\n      sender_UserName: \"나\",\r\n      room_RoomIdx: 1,\r\n    },\r\n    {\r\n      message: \"안녕!!!\",\r\n      time: \"2021-07-28\",\r\n      sender_UserIdx: 1,\r\n      sender_UserName: \"나\",\r\n      room_RoomIdx: 1,\r\n    },\r\n    {\r\n      message: \"안녕~\",\r\n      time: \"2021-07-28\",\r\n      sender_UserIdx: 1,\r\n      sender_UserName: \"친구\",\r\n      room_RoomIdx: 1,\r\n    },\r\n  ]);\r\n  var client = new Client();\r\n  client.configure({\r\n    brokerURL: \"ws://localhost:5000/sock\",\r\n    debug: function (str) {\r\n      console.log(str);\r\n    },\r\n    reconnectDelay: 5000,\r\n    heartbeatIncoming: 4000,\r\n    heartbeatOutgoing: 4000,\r\n    onConnect: () => {\r\n      console.log(\"onConnect\");\r\n    },\r\n  });\r\n\r\n  const callback = (message) => {\r\n    if (message.body) {\r\n      alert(\"got message with body \" + message.body);\r\n    } else {\r\n      alert(\"got empty message\");\r\n    }\r\n  };\r\n\r\n  client.onConnect = function (frame) {\r\n    client.subscribe(`/topic/${room_idx}`, callback);\r\n  };\r\n  client.onStompError = function (frame) {\r\n    console.log(\"Broker reported error: \" + frame.headers[\"message\"]);\r\n    console.log(\"Additional details: \" + frame.body);\r\n  };\r\n\r\n  client.activate();\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    // dispatch(getMessages(room_idx)).then((response) => {\r\n    //   if (response.payload) {\r\n    //     setMessage(response.payload);\r\n    //   } else {\r\n    //     console.log(\"메세지 목록 가져오기 에러\");\r\n    //   }\r\n    // });\r\n    last.current = \"\";\r\n  }, []);\r\n\r\n  const onInputChange = (e) => {\r\n    setMessage(e.target.value);\r\n    last.current = \"\";\r\n  };\r\n\r\n  const sendMessage = () => {\r\n    client.publish({\r\n      destination: \"/pub/message\",\r\n      body: JSON.stringify({\r\n        room_idx: room_idx,\r\n        user_idx: myid,\r\n        user_name: myname,\r\n        message: message,\r\n      }),\r\n    });\r\n    setMessage(\"\");\r\n  };\r\n\r\n  const disconnect = () => {\r\n    client.publish({\r\n      destination: \"/pub/message\",\r\n      body: JSON.stringify({\r\n        room_idx: room_idx,\r\n        user_idx: myid,\r\n      }),\r\n    });\r\n    close();\r\n  };\r\n\r\n  return (\r\n    // 모달이 열릴때 openModal 클래스가 생성된다.\r\n    <div\r\n      className={open ? \"openModal modal\" : \"modal\"}\r\n      style={{ backgroundColor: \"rgba(0, 0, 0, 0)\" }}\r\n    >\r\n      {open ? (\r\n        <section>\r\n          <header\r\n            style={{\r\n              height: \"95px\",\r\n              alignItems: \"center\",\r\n              display: \"flex\",\r\n              justifyContent: \"center\",\r\n              boxShadow: \"0px 5px 15px grey\",\r\n            }}\r\n          >\r\n            <div>\r\n              <Title>\r\n                {other ? other : member_idx ? member_idx : leader_idx}\r\n              </Title>\r\n            </div>\r\n            {header}\r\n            <button className=\"close\" onClick={disconnect}>\r\n              {\" \"}\r\n              &times;{\" \"}\r\n            </button>\r\n          </header>\r\n          <Content>\r\n            {messages?.map((message, i) => {\r\n              if (\r\n                last.current !== message.sender_UserName &&\r\n                message.sender_UserName !== myname\r\n              ) {\r\n                last.current = message.sender_UserName;\r\n                return (\r\n                  <Row>\r\n                    <img\r\n                      alt=\"profile\"\r\n                      src={require(\"../assets/profile.png\").default}\r\n                      style={{\r\n                        width: \"70px\",\r\n                        height: \"70px\",\r\n                        marginRight: \"10px\",\r\n                        position: \"absolute\",\r\n                      }}\r\n                    />\r\n                    <img\r\n                      alt=\"left\"\r\n                      src={require(\"../assets/left.png\").default}\r\n                      style={{\r\n                        width: \"28px\",\r\n                        height: \"17px\",\r\n                        marginRight: \"-112px\",\r\n                        marginLeft: \"85px\",\r\n                      }}\r\n                    />\r\n                    <Bubble>{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              } else if (message.sender_UserName !== myname) {\r\n                return (\r\n                  <Row>\r\n                    <Bubble marginLeft=\"100\">{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              } else if (\r\n                last.current !== myname &&\r\n                message.sender_UserName === myname\r\n              ) {\r\n                last.current = myname;\r\n                return (\r\n                  <Row location=\"flex-end\">\r\n                    <Bubble>{message.message}</Bubble>\r\n                    <img\r\n                      alt=\"right\"\r\n                      src={require(\"../assets/right.png\").default}\r\n                      style={{\r\n                        width: \"28px\",\r\n                        height: \"17px\",\r\n                        marginLeft: \"-27px\",\r\n                      }}\r\n                    />\r\n                  </Row>\r\n                );\r\n              } else {\r\n                return (\r\n                  <Row location=\"flex-end\">\r\n                    <Bubble>{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              }\r\n            })}\r\n          </Content>\r\n\r\n          <footer>\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                flexDirection: \"row\",\r\n                height: \"67px\",\r\n                alignItems: \"center\",\r\n                justifyContent: \"space-around\",\r\n              }}\r\n            >\r\n              <Input\r\n                width=\"382\"\r\n                validinput=\"true\"\r\n                placeholder=\"내용을 입력하세요\"\r\n                inputwidth=\"350\"\r\n                value={message}\r\n                onChange={onInputChange}\r\n              ></Input>\r\n              <img\r\n                alt=\"send\"\r\n                src={require(\"../assets/paperplane.png\").default}\r\n                style={{ width: \"31px\", height: \"34px\", cursor: \"pointer\" }}\r\n                onClick={sendMessage}\r\n              />\r\n            </div>\r\n          </footer>\r\n        </section>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"]},"metadata":{},"sourceType":"module"}
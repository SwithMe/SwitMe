{"ast":null,"code":"var _jsxFileName = \"D:\\\\SwitMe\\\\FrontEnd\\\\src\\\\components\\\\Chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport \"../assets/chat.css\";\nimport Title from \"./Title\";\nimport Input from \"./Input\";\nimport { getMessages } from \"../_actions/actions\";\nimport { useDispatch } from \"react-redux\";\nimport SockJS from \"sockjs-client\";\nimport { Client } from \"@stomp/stompjs\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Content = styled.div`\n  display: flex;\n  flex-direction: column;\n  min-height: 660px;\n  background-color: #56be9c;\n  padding: 30px;\n`;\n_c = Content;\nconst Row = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  justify-content: ${props => props.location || \"left\"};\n  align-items: center;\n`;\n_c2 = Row;\nconst Bubble = styled.div`\n  background-color: #ffffff;\n  border-radius: 10px;\n  font-family: \"NotoSans\";\n  font-size: 14px;\n  text-align: center;\n  padding: 10px;\n  max-width: 62px;\n  margin-bottom: 10px;\n  margin-left: 100px;\n  margin-right: 15px;\n  z-index: 5;\n`;\n_c3 = Bubble;\n\nconst Chat = props => {\n  _s();\n\n  // 열기, 닫기, 모달 헤더 텍스트를 부모로부터 받아옴\n  const {\n    open,\n    close,\n    header,\n    other_user,\n    other_user_name,\n    room_idx\n  } = props;\n  const myid = window.localStorage.getItem(\"id\");\n  const myname = \"나\";\n  const other = other_user;\n  const last = useRef(\"\");\n  const [message, setMessage] = useState();\n  const [messages, setMessages] = useState([]);\n  var client = new Client();\n  client.configure({\n    brokerURL: \"ws://localhost:8080/sock\",\n    debug: function (str) {\n      console.log(str);\n    },\n    reconnectDelay: 5000,\n    heartbeatIncoming: 4000,\n    heartbeatOutgoing: 4000,\n    onConnect: () => {\n      console.log(\"onConnect\");\n    }\n  });\n\n  const callback = message => {\n    if (message.body) {\n      alert(\"got message with body \" + message.body);\n    } else {\n      alert(\"got empty message\");\n    }\n  };\n\n  client.onConnect = function (frame) {\n    client.subscribe(`/topic/${room_idx}`, callback);\n  };\n\n  client.onStompError = function (frame) {\n    console.log(\"Broker reported error: \" + frame.headers[\"message\"]);\n    console.log(\"Additional details: \" + frame.body);\n  };\n\n  client.activate();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    dispatch(getMessages(room_idx)).then(response => {\n      if (response.payload) {\n        console.log(response);\n        setMessage(response.payload);\n      } else {\n        console.log(\"메세지 목록 가져오기 에러\");\n      }\n    });\n    last.current = \"\";\n  }, [messages]);\n\n  const onInputChange = e => {\n    setMessage(e.target.value);\n    last.current = \"\";\n  };\n\n  const sendMessage = () => {\n    client.publish({\n      destination: \"/pub/message\",\n      body: JSON.stringify({\n        room_idx: room_idx,\n        user_idx: myid,\n        user_name: myname,\n        message: message\n      })\n    });\n    setMessage(\"\");\n  };\n\n  const disconnect = () => {\n    client.onConnect = function (frame) {\n      client.publish({\n        destination: \"/pub/message\",\n        body: JSON.stringify({\n          room_idx: room_idx,\n          user_idx: myid\n        })\n      });\n    };\n\n    close();\n  };\n\n  return (\n    /*#__PURE__*/\n    // 모달이 열릴때 openModal 클래스가 생성된다.\n    _jsxDEV(\"div\", {\n      className: open ? \"openModal modal\" : \"modal\",\n      style: {\n        backgroundColor: \"rgba(0, 0, 0, 0)\"\n      },\n      children: open ? /*#__PURE__*/_jsxDEV(\"section\", {\n        children: [/*#__PURE__*/_jsxDEV(\"header\", {\n          style: {\n            height: \"95px\",\n            alignItems: \"center\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            boxShadow: \"0px 5px 15px grey\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(Title, {\n              children: other_user_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 142,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 13\n          }, this), header, /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"close\",\n            onClick: disconnect,\n            children: [\" \", \"\\xD7\", \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Content, {\n          children: messages === null || messages === void 0 ? void 0 : messages.map((message, i) => {\n            if (last.current !== message.sender_idx && message.sender_idx !== myid) {\n              last.current = message.sender_idx;\n              return /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  alt: \"profile\",\n                  src: message.self_image,\n                  style: {\n                    width: \"70px\",\n                    height: \"70px\",\n                    marginRight: \"10px\",\n                    position: \"absolute\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 159,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n                  alt: \"left\",\n                  src: require(\"../assets/left.png\").default,\n                  style: {\n                    width: \"28px\",\n                    height: \"17px\",\n                    marginRight: \"-112px\",\n                    marginLeft: \"85px\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 169,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Bubble, {\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 179,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 19\n              }, this);\n            } else if (message.sender_idx !== myid) {\n              return /*#__PURE__*/_jsxDEV(Row, {\n                children: /*#__PURE__*/_jsxDEV(Bubble, {\n                  marginLeft: \"100\",\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 185,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 19\n              }, this);\n            } else if (last.current !== myid && message.sender_idx === myid) {\n              last.current = myid;\n              return /*#__PURE__*/_jsxDEV(Row, {\n                location: \"flex-end\",\n                children: [/*#__PURE__*/_jsxDEV(Bubble, {\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 192,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n                  alt: \"right\",\n                  src: require(\"../assets/right.png\").default,\n                  style: {\n                    width: \"28px\",\n                    height: \"17px\",\n                    marginLeft: \"-27px\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 193,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 191,\n                columnNumber: 19\n              }, this);\n            } else {\n              return /*#__PURE__*/_jsxDEV(Row, {\n                location: \"flex-end\",\n                children: /*#__PURE__*/_jsxDEV(Bubble, {\n                  children: message.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 207,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 206,\n                columnNumber: 19\n              }, this);\n            }\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"footer\", {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              flexDirection: \"row\",\n              height: \"67px\",\n              alignItems: \"center\",\n              justifyContent: \"space-around\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              width: \"382\",\n              validinput: \"true\",\n              placeholder: \"\\uB0B4\\uC6A9\\uC744 \\uC785\\uB825\\uD558\\uC138\\uC694\",\n              inputwidth: \"350\",\n              value: message,\n              onChange: onInputChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n              alt: \"send\",\n              src: require(\"../assets/paperplane.png\").default,\n              style: {\n                width: \"31px\",\n                height: \"34px\",\n                cursor: \"pointer\"\n              },\n              onClick: sendMessage\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this) : null\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 5\n    }, this)\n  );\n};\n\n_s(Chat, \"3/wX3xUZntiBKMVtql3w71p3RFg=\", false, function () {\n  return [useDispatch];\n});\n\n_c4 = Chat;\nexport default Chat;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Content\");\n$RefreshReg$(_c2, \"Row\");\n$RefreshReg$(_c3, \"Bubble\");\n$RefreshReg$(_c4, \"Chat\");","map":{"version":3,"sources":["D:/SwitMe/FrontEnd/src/components/Chat.js"],"names":["React","useState","useRef","useEffect","styled","Title","Input","getMessages","useDispatch","SockJS","Client","Content","div","Row","props","location","Bubble","Chat","open","close","header","other_user","other_user_name","room_idx","myid","window","localStorage","getItem","myname","other","last","message","setMessage","messages","setMessages","client","configure","brokerURL","debug","str","console","log","reconnectDelay","heartbeatIncoming","heartbeatOutgoing","onConnect","callback","body","alert","frame","subscribe","onStompError","headers","activate","dispatch","then","response","payload","current","onInputChange","e","target","value","sendMessage","publish","destination","JSON","stringify","user_idx","user_name","disconnect","backgroundColor","height","alignItems","display","justifyContent","boxShadow","map","i","sender_idx","self_image","width","marginRight","position","require","default","marginLeft","flexDirection","cursor"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport \"../assets/chat.css\";\r\nimport Title from \"./Title\";\r\nimport Input from \"./Input\";\r\nimport { getMessages } from \"../_actions/actions\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport SockJS from \"sockjs-client\";\r\nimport { Client } from \"@stomp/stompjs\";\r\n\r\nconst Content = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  min-height: 660px;\r\n  background-color: #56be9c;\r\n  padding: 30px;\r\n`;\r\nconst Row = styled.div`\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: ${(props) => props.location || \"left\"};\r\n  align-items: center;\r\n`;\r\nconst Bubble = styled.div`\r\n  background-color: #ffffff;\r\n  border-radius: 10px;\r\n  font-family: \"NotoSans\";\r\n  font-size: 14px;\r\n  text-align: center;\r\n  padding: 10px;\r\n  max-width: 62px;\r\n  margin-bottom: 10px;\r\n  margin-left: 100px;\r\n  margin-right: 15px;\r\n  z-index: 5;\r\n`;\r\n\r\nconst Chat = (props) => {\r\n  // 열기, 닫기, 모달 헤더 텍스트를 부모로부터 받아옴\r\n  const { open, close, header, other_user, other_user_name, room_idx } = props;\r\n  const myid = window.localStorage.getItem(\"id\");\r\n  const myname = \"나\";\r\n  const other = other_user;\r\n  const last = useRef(\"\");\r\n  const [message, setMessage] = useState();\r\n  const [messages, setMessages] = useState([]);\r\n  var client = new Client();\r\n  client.configure({\r\n    brokerURL: \"ws://localhost:8080/sock\",\r\n    debug: function (str) {\r\n      console.log(str);\r\n    },\r\n    reconnectDelay: 5000,\r\n    heartbeatIncoming: 4000,\r\n    heartbeatOutgoing: 4000,\r\n    onConnect: () => {\r\n      console.log(\"onConnect\");\r\n    },\r\n  });\r\n\r\n  const callback = (message) => {\r\n    if (message.body) {\r\n      alert(\"got message with body \" + message.body);\r\n    } else {\r\n      alert(\"got empty message\");\r\n    }\r\n  };\r\n\r\n  client.onConnect = function (frame) {\r\n    client.subscribe(`/topic/${room_idx}`, callback);\r\n  };\r\n  client.onStompError = function (frame) {\r\n    console.log(\"Broker reported error: \" + frame.headers[\"message\"]);\r\n    console.log(\"Additional details: \" + frame.body);\r\n  };\r\n\r\n  client.activate();\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(getMessages(room_idx)).then((response) => {\r\n      if (response.payload) {\r\n        console.log(response);\r\n        setMessage(response.payload);\r\n      } else {\r\n        console.log(\"메세지 목록 가져오기 에러\");\r\n      }\r\n    });\r\n    last.current = \"\";\r\n  }, [messages]);\r\n\r\n  const onInputChange = (e) => {\r\n    setMessage(e.target.value);\r\n    last.current = \"\";\r\n  };\r\n\r\n  const sendMessage = () => {\r\n    client.publish({\r\n      destination: \"/pub/message\",\r\n      body: JSON.stringify({\r\n        room_idx: room_idx,\r\n        user_idx: myid,\r\n        user_name: myname,\r\n        message: message,\r\n      }),\r\n    });\r\n    setMessage(\"\");\r\n  };\r\n\r\n  const disconnect = () => {\r\n    client.onConnect = function (frame) {\r\n      client.publish({\r\n        destination: \"/pub/message\",\r\n        body: JSON.stringify({\r\n          room_idx: room_idx,\r\n          user_idx: myid,\r\n        }),\r\n      });\r\n    };\r\n    close();\r\n  };\r\n\r\n  return (\r\n    // 모달이 열릴때 openModal 클래스가 생성된다.\r\n    <div\r\n      className={open ? \"openModal modal\" : \"modal\"}\r\n      style={{ backgroundColor: \"rgba(0, 0, 0, 0)\" }}\r\n    >\r\n      {open ? (\r\n        <section>\r\n          <header\r\n            style={{\r\n              height: \"95px\",\r\n              alignItems: \"center\",\r\n              display: \"flex\",\r\n              justifyContent: \"center\",\r\n              boxShadow: \"0px 5px 15px grey\",\r\n            }}\r\n          >\r\n            <div>\r\n              <Title>{other_user_name}</Title>\r\n            </div>\r\n            {header}\r\n            <button className=\"close\" onClick={disconnect}>\r\n              {\" \"}\r\n              &times;{\" \"}\r\n            </button>\r\n          </header>\r\n          <Content>\r\n            {messages?.map((message, i) => {\r\n              if (\r\n                last.current !== message.sender_idx &&\r\n                message.sender_idx !== myid\r\n              ) {\r\n                last.current = message.sender_idx;\r\n                return (\r\n                  <Row>\r\n                    <img\r\n                      alt=\"profile\"\r\n                      src={message.self_image}\r\n                      style={{\r\n                        width: \"70px\",\r\n                        height: \"70px\",\r\n                        marginRight: \"10px\",\r\n                        position: \"absolute\",\r\n                      }}\r\n                    />\r\n                    <img\r\n                      alt=\"left\"\r\n                      src={require(\"../assets/left.png\").default}\r\n                      style={{\r\n                        width: \"28px\",\r\n                        height: \"17px\",\r\n                        marginRight: \"-112px\",\r\n                        marginLeft: \"85px\",\r\n                      }}\r\n                    />\r\n                    <Bubble>{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              } else if (message.sender_idx !== myid) {\r\n                return (\r\n                  <Row>\r\n                    <Bubble marginLeft=\"100\">{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              } else if (last.current !== myid && message.sender_idx === myid) {\r\n                last.current = myid;\r\n                return (\r\n                  <Row location=\"flex-end\">\r\n                    <Bubble>{message.message}</Bubble>\r\n                    <img\r\n                      alt=\"right\"\r\n                      src={require(\"../assets/right.png\").default}\r\n                      style={{\r\n                        width: \"28px\",\r\n                        height: \"17px\",\r\n                        marginLeft: \"-27px\",\r\n                      }}\r\n                    />\r\n                  </Row>\r\n                );\r\n              } else {\r\n                return (\r\n                  <Row location=\"flex-end\">\r\n                    <Bubble>{message.message}</Bubble>\r\n                  </Row>\r\n                );\r\n              }\r\n            })}\r\n          </Content>\r\n\r\n          <footer>\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                flexDirection: \"row\",\r\n                height: \"67px\",\r\n                alignItems: \"center\",\r\n                justifyContent: \"space-around\",\r\n              }}\r\n            >\r\n              <Input\r\n                width=\"382\"\r\n                validinput=\"true\"\r\n                placeholder=\"내용을 입력하세요\"\r\n                inputwidth=\"350\"\r\n                value={message}\r\n                onChange={onInputChange}\r\n              ></Input>\r\n              <img\r\n                alt=\"send\"\r\n                src={require(\"../assets/paperplane.png\").default}\r\n                style={{ width: \"31px\", height: \"34px\", cursor: \"pointer\" }}\r\n                onClick={sendMessage}\r\n              />\r\n            </div>\r\n          </footer>\r\n        </section>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"]},"metadata":{},"sourceType":"module"}